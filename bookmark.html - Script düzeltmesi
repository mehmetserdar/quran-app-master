// renderSureBookmarks ve renderAyahBookmarks fonksiyonlarını düzeltmek gerekiyor
function renderSureBookmarks() {
    const bookmarkList = document.getElementById('list-bookmark');
    
    // Sort sures by ID
    const sortedSures = [...bookmarks.sures].sort((a, b) => a - b);
    
    sortedSures.forEach((sureId, index) => {
        // Find sure data - düzeltilmiş kod
        let sureItem = null;
        
        // Global sure değişkeni tanımlıysa onu kullan
        if (typeof sure !== 'undefined' && Array.isArray(sure)) {
            sureItem = sure.find(s => s.id === sureId);
        } 
        // Global sureData değişkeni tanımlıysa onu kullan
        else if (typeof sureData !== 'undefined' && Array.isArray(sureData)) {
            sureItem = sureData.find(s => s.id === sureId);
        }
        // Hiçbiri yoksa, readData fonksiyonunu tanımlayalım
        else {
            // readData fonksiyonu ekleniyor
            if (typeof readData !== 'function') {
                function readData() {
                    // Basit bir veri yapısı oluştur
                    return [
                        { id: sureId, name: "Sure " + sureId, meaning: "Veri Yüklenemedi", ayat: "?" }
                    ];
                }
            }
            
            const tempData = readData();
            sureItem = tempData.find(s => s.id === sureId);
        }
        
        if (!sureItem) {
            sureItem = { 
                id: sureId, 
                name: "Sure " + sureId, 
                meaning: "Veri yüklenemedi", 
                ayat: "?"
            };
        }
        
        const bookmarkElement = createSureBookmarkElement(sureItem, index);
        bookmarkList.appendChild(bookmarkElement);
    });
}

function renderAyahBookmarks() {
    const bookmarkList = document.getElementById('list-bookmark');
    
    bookmarks.ayahs.forEach((ayahId, index) => {
        const [sureId, ayahNumber] = ayahId.split('-').map(Number);
        
        // Find sure data - düzeltilmiş kod
        let sureItem = null;
        
        // Global sure değişkeni tanımlıysa onu kullan
        if (typeof sure !== 'undefined' && Array.isArray(sure)) {
            sureItem = sure.find(s => s.id === sureId);
        } 
        // Global sureData değişkeni tanımlıysa onu kullan
        else if (typeof sureData !== 'undefined' && Array.isArray(sureData)) {
            sureItem = sureData.find(s => s.id === sureId);
        }
        // Hiçbiri yoksa, readData fonksiyonunu tanımlayalım
        else {
            // readData fonksiyonu ekleniyor
            if (typeof readData !== 'function') {
                function readData() {
                    // Basit bir veri yapısı oluştur
                    return [
                        { 
                            id: sureId, 
                            name: "Sure " + sureId, 
                            meaning: "Veri Yüklenemedi", 
                            ayat: "?",
                            text: "بسم الله الرحمن الرحيم",
                            translation: "Allah'ın adıyla."
                        }
                    ];
                }
            }
            
            const tempData = readData();
            sureItem = tempData.find(s => s.id === sureId);
        }
        
        if (!sureItem) {
            sureItem = { 
                id: sureId, 
                name: "Sure " + sureId, 
                meaning: "Veri yüklenemedi", 
                ayat: "?",
                text: "بسم الله الرحمن الرحيم",
                translation: "Allah'ın adıyla."
            };
        }
        
        const bookmarkElement = createAyahBookmarkElement(sureItem, ayahNumber, index);
        bookmarkList.appendChild(bookmarkElement);
    });
}

// extractAyahContent fonksiyonunda da hata olabilir, düzeltelim
function extractAyahContent(sureData, ayahNumber) {
    const result = {
        arabic: '',
        turkish: ''
    };
    
    try {
        // Try to extract content from available data
        if (sureData && sureData.text) {
            // Very simplified extraction - would need proper parsing
            const arabicAyahs = sureData.text.split(/﴿\d+﴾/).filter(text => text.trim() !== '');
            if (arabicAyahs && arabicAyahs.length >= ayahNumber && arabicAyahs[ayahNumber-1]) {
                result.arabic = arabicAyahs[ayahNumber-1];
            } else {
                // Fallback
                result.arabic = "بسم الله الرحمن الرحيم";
            }
        }
        
        if (sureData && sureData.translation) {
            // Very simplified extraction - would need proper parsing
            const turkishAyahs = sureData.translation.split('. ');
            if (turkishAyahs && turkishAyahs.length >= ayahNumber && turkishAyahs[ayahNumber-1]) {
                result.turkish = turkishAyahs[ayahNumber-1];
            } else {
                // Fallback
                result.turkish = "Allah'ın adıyla başlarım.";
            }
        }
    } catch (e) {
        console.error('Ayet içeriği çıkarılırken hata oluştu:', e);
        result.arabic = "بسم الله الرحمن الرحيم";
        result.turkish = "Allah'ın adıyla başlarım.";
    }
    
    return result;
}

// Ayrıca sure.js dosyasını yüklemek için bir yedek mekanizma ekleyelim
document.addEventListener('DOMContentLoaded', function() {
    // sure.js yüklenmiş mi kontrol et
    if (typeof sure === 'undefined' && typeof sureData === 'undefined') {
        console.warn('sure.js dosyası yüklenemedi, yedek yükleniyor...');
        
        // Yedek sure verisi fonksiyonu
        window.readData = function() {
            return [
                { id: 1, name: "Fatiha", meaning: "Açılış", ayat: 7, text: "بسم الله الرحمن الرحيم", translation: "Allah'ın adıyla." },
                { id: 112, name: "İhlas", meaning: "Samimiyet", ayat: 4, text: "بسم الله الرحمن الرحيم", translation: "Allah'ın adıyla." },
                { id: 113, name: "Felak", meaning: "Şafak", ayat: 5, text: "بسم الله الرحمن الرحيم", translation: "Allah'ın adıyla." },
                { id: 114, name: "Nas", meaning: "İnsanlar", ayat: 6, text: "بسم الله الرحمن الرحيم", translation: "Allah'ın adıyla." }
            ];
        };
        
        // Global değişkeni ayarla
        window.sure = window.readData();
    }
});